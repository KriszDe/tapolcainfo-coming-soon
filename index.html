<!doctype html>
<meta charset="utf-8"/>
<title>Borostyán-tó hajókövetés</title>
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
<style>
  html,body,#map{height:100%;margin:0}
  .info{position:absolute;left:10px;top:10px;z-index:1000;background:#fff;padding:8px;border-radius:6px;box-shadow:0 2px 6px rgba(0,0,0,.15)}
</style>
<div id="map"></div>
<div class="info" id="info">Csatlakozás...</div>
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script>
  const map = L.map('map').setView([46.7, 16.6], 14); // kezdő nézet, állítsd át Borostyán-tóra
  L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',{maxZoom:19}).addTo(map);

  // jelölő és vonal
  let marker = null;
  let path = L.polyline([], {color:'blue'}).addTo(map);

  const info = document.getElementById('info');

  // WebSocket: várja a GPS adatot ws://localhost:8765
  const ws = new WebSocket('ws://localhost:8765/');
  ws.onopen = ()=> info.textContent = 'Kapcsolódva a helyadat forráshoz';
  ws.onclose = ()=> info.textContent = 'Kapcsolat bontva';
  ws.onerror = (e)=> info.textContent = 'Hiba a WS kapcsolaton';

  ws.onmessage = (ev) => {
    try {
      const obj = JSON.parse(ev.data);
      if (!obj.lat || !obj.lon) return;
      const lat = parseFloat(obj.lat), lon = parseFloat(obj.lon);
      const latlng = [lat, lon];
      if (!marker) {
        marker = L.marker(latlng).addTo(map);
        map.setView(latlng, 16);
      } else {
        marker.setLatLng(latlng);
      }
      path.addLatLng(latlng);

      // kis infó: távolság parttól (ha adtok part koordinátát), most csak mutatjuk lat/lon
      info.innerHTML = `Pozíció: ${lat.toFixed(6)}, ${lon.toFixed(6)}<br>Idő: ${obj.time || new Date().toLocaleTimeString()}`;
    } catch(e){ console.error(e) }
  };
</script>
